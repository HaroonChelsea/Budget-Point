"use strict";var dateCtrl={currentDate:function(){var t=new Date,e=new Array;e[0]="January",e[1]="February",e[2]="March",e[3]="April",e[4]="May",e[5]="June",e[6]="July",e[7]="August",e[8]="September",e[9]="October",e[10]="November",e[11]="December";var n=e[t.getMonth()],a=t.getFullYear();document.querySelector(".yearAndMonth").innerText="".concat(n,", ").concat(a)}},storageCtrl={storeItem:function(t){var e=[];null===localStorage.getItem("items")?(e=[]).push(t):(e=JSON.parse(localStorage.getItem("items"))).push(t),localStorage.setItem("items",JSON.stringify(e))},getDataFromStore:function(){var t=null===localStorage.getItem("items")?[]:JSON.parse(localStorage.getItem("items"));return t},updateItem:function(n){var a=JSON.parse(localStorage.getItem("items"));a.forEach(function(t,e){t.id===n.id&&a.splice(e,1,n)}),localStorage.setItem("items",JSON.stringify(a))},deleteData:function(n){var a=JSON.parse(localStorage.getItem("items"));a.forEach(function(t,e){n===t.id&&a.splice(e,1)}),localStorage.setItem("items",JSON.stringify(a));var t=budgetCtrl.getTotalBudget();uiCtrl.showTotalBudget(t)}},budgetCtrl=function(){function o(t,e,n,a){this.id=t,this.name=e,this.value=n,this.type=a}var d={budgetItemsArr:storageCtrl.getDataFromStore(),currentBudgetItem:null,totalBudget:0,totalIncome:0,totalExpense:0,totalExpensePercent:0};return{getBudgetItems:function(){return d.budgetItemsArr},addNewBudgetItem:function(t,e,n){var a=0<d.budgetItemsArr.length?d.budgetItemsArr[d.budgetItemsArr.length-1].id+1:0,l=new o(a,t,e,n);return d.budgetItemsArr.push(l),l},getTotalBudget:function(){var e=0,n=0;return d.budgetItemsArr.forEach(function(t){"Income"===t.type?e+=+t.value:n+=+t.value}),d.budgetItemsArr.forEach(function(t){"Expense"===t.type&&(t.expensePercent=0<e?Math.round(100*t.value/e):"---")}),d.totalIncome=e,d.totalExpense=n,d.totalBudget=e-n,0<e&&(d.totalExpensePercent=Math.round(100*n/e)),{totalBud:d.totalBudget,totalInc:d.totalIncome,totalExp:d.totalExpense,totalExpPer:d.totalExpensePercent}},getItemByID:function(e){var n=null;return d.budgetItemsArr.forEach(function(t){t.id===e&&(n=t)}),n},setCurrentItemToData:function(t){d.currentBudItem=t},getCurrentItem:function(){return d.currentBudItem},updateData:function(e,n,a){var l=null;return d.budgetItemsArr.forEach(function(t){t.id===d.currentBudItem.id&&(t.name=e,t.value=n,t.type=a,l=t)}),l},deleteData:function(t){var e=d.budgetItemsArr.map(function(t){return t.id}).indexOf(t);d.budgetItemsArr.splice(e,1)},logData:function(){return d}}}(),uiCtrl=function(){var a={tableInc:"tableIncome",tableExp:"tableExpense",addBtn:"fa-check-circle",inputDescription:"budgetDescription",inputBudgetValue:"budgetValue",inputTypeSelect:"budgetTypeSelect",totalBudget:"totalBudget",totalIncome:"totalIncome",totalExpense:"totalExpense",totalExPer:"totalExpensePercent",tableStriped:"table-striped",updateBtn:"updateBtn",delBtn:"delBtn",backBtn:"backBtn"};return{paintTableTD:function(t){var e="",n="";t.forEach(function(t){"Income"===t.type?e+='\n                          <tr id="tableRow-'.concat(t.id,'">\n                            <td class="font-weight-bold">').concat(t.name,'</td>\n                            <td class="text-primary font-weight-bold">+').concat(t.value,'</td>\n                            <td class="remove d-flex justify-content-around"><svg id="icon-circle-with-cross" class="delClickBtn">\n                            <use pointer-events="auto"  xlink:href="dist/img/sprite.svg#icon-circle-with-cross">\n                            </use>\n                        </svg>\n                        <svg id="icon-edit" class="updateClickBtn">\n                            <use pointer-events="auto" xlink:href="dist/img/sprite.svg#icon-edit">\n                            </use>\n                        </svg></td>\n                          </tr>\n                '):n+='\n                          <tr id="tableRow-'.concat(t.id,'">\n                            <td class="font-weight-bold">').concat(t.name,'</td>\n                            <td class="text-danger font-weight-bold">-').concat(t.value,' <span class="badge badge-danger">').concat(t.expensePercent,'%</span> </td>\n                            <td class="remove d-flex justify-content-around"><svg id="icon-circle-with-cross" class="delClickBtn">\n                            <use pointer-events="auto"  xlink:href="dist/img/sprite.svg#icon-circle-with-cross">\n                            </use>\n                        </svg>\n                        <svg id="icon-edit" class="updateClickBtn">\n                            <use pointer-events="auto" xlink:href="dist/img/sprite.svg#icon-edit">\n                            </use>\n                        </svg></td>\n                          </tr>\n                '),document.getElementById(a.tableInc).innerHTML=e,document.getElementById(a.tableExp).innerHTML=n})},getInputData:function(){return{name:document.getElementById(a.inputDescription).value,value:document.getElementById(a.inputBudgetValue).value,type:document.getElementById(a.inputTypeSelect).value}},addNewBudItemToTable:function(t){var e=document.createElement("tr");"Income"===t.type?(e.setAttribute("id","tableRow-".concat(t.id)),e.innerHTML='\n                            <td class="font-weight-bold">'.concat(t.name,'</td>\n                            <td class="text-primary font-weight-bold">+').concat(t.value,'</td>\n                            <td class="remove d-flex justify-content-around"><svg id="icon-circle-with-cross" class="delClickBtn">\n                            <use pointer-events="auto"  xlink:href="dist/img/sprite.svg#icon-circle-with-cross">\n                            </use>\n                        </svg>\n                        <svg id="icon-edit" class="updateClickBtn">\n                            <use pointer-events="auto" xlink:href="dist/img/sprite.svg#icon-edit">\n                            </use>\n                        </svg></td>\n                '),document.getElementById(a.tableInc).insertAdjacentElement("beforeend",e)):"Expense"===t.type&&(e.setAttribute("id","tableRow-".concat(t.id)),e.innerHTML='\n                            <td class="font-weight-bold">'.concat(t.name,'</td>\n                            <td class="text-danger font-weight-bold">-').concat(t.value,' <span class="badge badge-danger">').concat(t.expensePercent,'%</span> </td>\n                            <td class="remove d-flex justify-content-around"><svg id="icon-circle-with-cross" class="delClickBtn">\n                            <use pointer-events="auto"  xlink:href="dist/img/sprite.svg#icon-circle-with-cross">\n                            </use>\n                        </svg>\n                        <svg id="icon-edit" class="updateClickBtn">\n                            <use pointer-events="auto" xlink:href="dist/img/sprite.svg#icon-edit">\n                            </use>\n                        </svg></td>\n                '),document.getElementById(a.tableExp).insertAdjacentElement("beforeend",e))},clearInputFields:function(){document.getElementById(a.inputDescription).value="",document.getElementById(a.inputBudgetValue).value="",document.getElementById(a.updateBtn).style.display="none",document.getElementById(a.delBtn).style.display="none",document.getElementById(a.backBtn).style.display="none",document.getElementById(a.addBtn).style.display="block"},showEditState:function(){document.getElementById(a.addBtn).style.display="none",document.getElementById(a.updateBtn).style.display="block",document.getElementById(a.delBtn).style.display="block",document.getElementById(a.backBtn).style.display="block"},setItemToForm:function(){document.getElementById(a.inputDescription).value=budgetCtrl.getCurrentItem().name,document.getElementById(a.inputBudgetValue).value=budgetCtrl.getCurrentItem().value,"Income"===budgetCtrl.getCurrentItem().type?document.getElementById(a.inputTypeSelect).selectedIndex=0:document.getElementById(a.inputTypeSelect).selectedIndex=1,uiCtrl.showEditState()},showTotalBudget:function(t){document.getElementById(a.totalBudget).textContent=t.totalBud,document.getElementById(a.totalIncome).textContent="+"+t.totalInc,document.getElementById(a.totalExpense).innerText="-"+t.totalExp,0<t.totalInc?document.getElementById(a.totalExPer).innerText=t.totalExpPer+"%":document.getElementById(a.totalExPer).innerText="---"},updateTableData:function(l){var t=document.getElementsByTagName("tr");Array.from(t).forEach(function(t){var e=t.getAttribute("id");e==="tabelRow-".concat(e)&&("Income"===l.type?document.querySelector("#".concat(e)).innerHTML='\n                    <td class="font-weight-bold">'.concat(item.name,'</td>\n                    <td class="text-primary font-weight-bold">+').concat(item.value,'</td>\n                    <td class="remove d-flex justify-content-around"><svg id="icon-circle-with-cross" class="delClickBtn">\n                    <use pointer-events="auto"  xlink:href="dist/img/sprite.svg#icon-circle-with-cross">\n                    </use>\n                </svg>\n                <svg id="icon-edit" class="updateClickBtn">\n                    <use pointer-events="auto" xlink:href="dist/img/sprite.svg#icon-edit">\n                    </use>\n                </svg></td>\n                    '):document.querySelector("#".concat(e)).innerHTML='\n                        <td class="font-weight-bold">'.concat(item.name,'</td>\n                        <td class="text-danger font-weight-bold">-').concat(item.value,' <span class="badge badge-danger">').concat(item.expensePercent,'%</span> </td>\n                        <td class="remove d-flex justify-content-around"><svg id="icon-circle-with-cross" class="delClickBtn">\n                        <use pointer-events="auto"  xlink:href="dist/img/sprite.svg#icon-circle-with-cross">\n                        </use>\n                    </svg>\n                    <svg id="icon-edit" class="updateClickBtn">\n                        <use pointer-events="auto" xlink:href="dist/img/sprite.svg#icon-edit">\n                        </use>\n                    </svg></td>\n                        ')),uiCtrl.clearInputFields();var n=budgetCtrl.getTotalBudget();uiCtrl.showTotalBudget(n);var a=budgetCtrl.getBudgetItems();uiCtrl.paintTableTD(a)})},deleteCurrentDataRow:function(e){var t=document.getElementsByTagName("tr");Array.from(t).forEach(function(t){t.getAttribute("id")==="tableRow-".concat(e)&&t.remove()})},getSelectors:function(){return a}}}(),appCtrl=function(c,s){var a=function(t){var e,n,a,l=s.getInputData(),o=s.getSelectors();""!==l.name?""!==l.value?(e=c.addNewBudgetItem(l.name,l.value,l.type),s.addNewBudItemToTable(e),storageCtrl.storeItem(e),s.clearInputFields(),n=c.getTotalBudget(),s.showTotalBudget(n),a=c.getBudgetItems(),s.paintTableTD(a)):(document.getElementById(o.inputBudgetValue).classList.add("is-invalid"),setTimeout(function(){document.getElementById(o.inputBudgetValue).classList.remove("is-invalid")},3e3)):(document.getElementById(o.inputDescription).classList.add("is-invalid"),setTimeout(function(){document.getElementById(o.inputDescription).classList.remove("is-invalid")},3e3)),t.preventDefault()},l=function(t){var e,n,a,l,o,d,i,r;t.target.classList.contains("updateClickBtn")&&(e=t.target.parentNode.parentNode.id.split("-"),n=parseInt(e[1]),a=c.getItemByID(n),c.setCurrentItemToData(a),s.setItemToForm()),t.target.classList.contains("delClickBtn")&&(l=t.target.parentNode.parentNode.id.split("-"),o=parseInt(l[1]),d=c.getItemByID(o),c.setCurrentItemToData(d),c.deleteData(o),storageCtrl.deleteData(o),s.deleteCurrentDataRow(o),i=c.getTotalBudget(),s.showTotalBudget(i),r=c.getBudgetItems(),s.clearInputFields(),s.paintTableTD(r)),t.preventDefault()},o=function(t){var e=s.getInputData(),n=c.updateData(e.name,e.value,e.type);storageCtrl.updateItem(n),s.updateTableData(n),t.preventDefault()},d=function(t){var e=c.getCurrentItem().id;c.deleteData(e),storageCtrl.deleteData(e),s.deleteCurrentDataRow(e),s.clearInputFields();var n=c.getTotalBudget();s.showTotalBudget(n);var a=c.getBudgetItems();s.paintTableTD(a),t.preventDefault()};return{init:function(){dateCtrl.currentDate(),s.clearInputFields(),console.log("Running.....");var t,e=c.getBudgetItems(),n=c.getTotalBudget();s.showTotalBudget(n),s.paintTableTD(e),t=s.getSelectors(),document.getElementById(t.addBtn).addEventListener("keypress",function(t){return 13!==t.keyCode&&13!==t.which||t.preventDefault(),!1}),document.getElementById(t.addBtn).addEventListener("click",a),document.getElementById(t.tableStriped).addEventListener("click",l),document.getElementById(t.updateBtn).addEventListener("click",o),document.getElementById(t.backBtn).addEventListener("click",s.clearInputFields),document.getElementById(t.delBtn).addEventListener("click",d)}}}(budgetCtrl,uiCtrl);appCtrl.init();